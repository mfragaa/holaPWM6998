//******************************************************************************
// En proceso de portarse del g2553 al fr6989
//  Hola_PWM.c - Genera una senial PWM modulada por una senial de voz,
//    usando el canal 1 del timer A1. El reloj del timer se alimenta
//    DCO a 8MHz. La senial PWM tiene  un periodo de 200 ciclos de
//    reloj, correspondiente a 40KHz. El registro del canal 0 fija el
//    periodo de la senial y el del canal 1 el ciclo de servicio.
//    Cada 10 ciclos se modifica el ciclo de servicio, lo que
//    corresponde a una frecuencia de muestreo de 8KHz. Se tienen 3622
//    muestras de la senial de voz, aprox. 452 mS de senial.
//
//
//
//           MSP430FR6989
//         ---------------
//     /|\|            XIN|--
//      | |               |
//      --|RST        XOUT|--
//        |               |
//        |           P3.3|-->Filtro pasa bajas Fc=3.3KHz
//                              R=4700 ohms, C=10nF
//
// Hecho por Miguelangel Fraga Aguilar.
// Septiembre 2020
//******************************************************************************

#include <msp430.h>

//Varibles globales para el Generador de tonos
volatile unsigned ciclos,indice;
/***************************************************************
 * los valores de la senial se grabaron a 8KHz en un archivo wav y
 * se uso el script de octave holas.m para poderlos incluir en
 * el codigo fuente de c.
****************************************************************/
const unsigned char senial[3622]={
    98, 97, 98, 99, 99, 99, 98, 99, 99, 99, 99, 99, 99, 99, 99,
 99, 99,100,100,101,100,101,102,102,101,102,101,102,101,100,
100, 99, 99, 99, 99,100,101,101,101,100,101,101,101,101,102,
103,104,103,103,102,103,103,103,103,103,103,103,103,102,102,
102,103,102,102,101,100,100,101,101,102,103,103,102,102,102,
103,103,102,101,101,101,101,101,101,101,101,101,101,101,101,
101,100,101,101,101,101,101,101,101,102,101,100,100,100,100,
100,100, 99, 99, 99, 99, 99, 99, 99, 99,100, 99, 99, 99, 99,
 99, 99, 99, 99, 98, 98, 97, 98, 97, 98, 99, 99, 99, 98, 98,
 98, 98, 98, 99, 99, 98, 98, 99, 99, 99, 99, 99, 99, 99, 98,
 98, 99, 98, 98, 98, 98, 99, 98, 98, 98, 98, 98, 98, 98, 98,
 97, 97, 97, 98, 98, 98, 98, 98, 98, 98, 97, 97, 97, 97, 98,
 98, 97, 97, 97, 97, 97, 96, 95, 96, 96, 97, 98, 94, 90, 95,
 91, 94, 99, 96,101,102,100, 99,102, 99, 98, 98, 98, 97, 97,
 98, 96, 98, 98,100, 98, 97, 98, 97, 98,101,102,100,100,100,
 97, 96, 97, 98,101,104,105,105,104,102,100,100,101,103,103,
104,103,101, 99, 98, 99, 98, 99,100,100,101,100, 99, 98, 97,
 96, 95, 96, 96, 97, 98,100,101,102,102,101,101,100,100,100,
101,101,101,103,103,104,104,103,103,103,102,104,106,110,113,
116,117,116,116,114,115,119,120,123,125,125,112, 82, 72, 56,
 50, 66, 66, 85,106,110,103,110,100, 84, 82, 74, 66, 62, 72,
 73, 87,100,105,104, 97, 87, 78, 80, 87,102,114,121,119,111,
 94, 86, 82, 86, 99,115,126,133,139,134,128,122,117,113,115,
120,127,139,143,125,100, 68, 50, 50, 50, 55, 74,103,115,120,
120,116,100, 90, 80, 64, 57, 50, 50, 53, 72, 85, 98,102, 94,
 86, 82, 83, 95,110,120,119,108, 88, 68, 64, 63, 79,101,115,
126,124,117,111,108,112,119,121,121,113,104, 99,100,111,131,
149,149,149,149,149,142, 92, 51, 50, 50, 51, 50, 56, 92,125,
131,141,148,125,114, 99, 80, 57, 54, 51, 50, 57, 65, 82, 94,
100,102,109,107,112,113,107, 99, 87, 72, 60, 60, 67, 81,105,
123,133,142,138,131,128,127,124,125,123,114,110,102,105,116,
134,149,149,149,149,149,146, 94, 50, 51, 50, 50, 50, 52, 92,
124,128,144,149,128,116,103, 86, 65, 59, 53, 50, 50, 51, 66,
 80, 99,114,124,132,134,123,110, 88, 61, 50, 50, 50, 51, 74,
104,125,140,144,139,124,114,108,103,109,114,114,119,115,119,
123,136,149,149,149,149,149,149,136, 86, 50, 51, 50, 50, 50,
 62,102,136,141,133,144,126,107,102, 89, 73, 59, 57, 50, 50,
 61, 77, 84,105,105,104,110,106,106, 99, 86, 69, 52, 50, 50,
 52, 73, 98,125,138,139,133,116,101, 94, 94, 96,106,114,115,
115,118,126,136,149,149,149,149,149,149,149,135, 74, 50, 51,
 50, 50, 59, 77,116,148,143,143,149,136,121,110, 80, 54, 50,
 50, 50, 53, 77, 95,109,121,111,110,109,110,100, 92, 70, 50,
 50, 50, 50, 63, 88,104,122,115,111,105,105,103,113,122,117,
118,109, 99, 98,107,125,147,149,149,149,149,148,149,147,149,
117, 52, 50, 50, 50, 50, 61,104,145,149,148,149,149,143,122,
 87, 51, 50, 50, 51, 50, 68,119,138,149,141,118,104,101, 90,
 75, 58, 50, 50, 50, 50, 53, 88,114,124,125,113,105,102,104,
108,114,112,113,107,105, 96,104,115,133,149,149,149,149,149,
149,149,149,140, 67, 50, 51, 50, 50, 63, 77,110,147,132,145,
149,149,133, 95, 53, 50, 50, 50, 50, 69,129,149,148,128,110,
 88, 91, 99, 84, 61, 50, 50, 50, 50, 51, 68, 96,112,105,102,
101,106,108,111,120,112,114,114,104,106,103,114,125,142,149,
149,149,149,149,149,148,149,134, 61, 50, 51, 50, 51, 69, 92,
121,149,148,149,147,149,120, 55, 50, 50, 50, 50, 54,105,144,
147,117,107,116,113,122,117, 69, 50, 50, 50, 50, 51, 76, 92,
104,107,102,100,115,116,117,129,123,120,116,108, 99,101,110,
116,125,144,149,149,148,149,148,149,147,149,131, 57, 50, 50,
 50, 51, 81,105,131,149,148,149,149,144, 73, 50, 51, 50, 51,
 50, 76,104,124,124,107,116,143,132,114, 82, 50, 50, 50, 50,
 50, 57, 80, 74, 71, 79, 85,102,126,136,134,126,115,105,102,
114,116,125,125,114,108,124,147,149,148,149,147,149,146,149,
116, 50, 51, 50, 50, 51, 78, 96,128,149,149,149,149,118, 53,
 50, 50, 50, 51, 50, 65, 67, 86,110,113,143,149,138,106, 75,
 51, 50, 50, 50, 50, 50, 50, 50, 61, 94,107,127,149,149,145,
132,113, 91,106,118,121,117,111,100,108,143,149,148,149,148,
149,147,149,117, 51, 50, 50, 50, 50, 50, 57,109,146,149,148,
149,129, 65, 50, 50, 50, 50, 50, 50, 50, 59, 91,131,148,149,
143,132,116,101, 81, 56, 50, 50, 50, 50, 50, 50, 64, 95,129,
149,149,149,140,118,103,104,115,120,106,106, 99,102,131,149,
149,148,149,148,149,147,149,100, 50, 51, 50, 51, 50, 51, 50,
 84,128,149,147,149,113, 71, 64, 50, 70, 57, 50, 50, 50, 50,
 69, 87, 90, 78, 75, 92,102,120,118,109, 76, 55, 50, 50, 50,
 50, 50, 59, 85,105,107,102,115,126,142,146,147,128,106,110,
107,111,118,141,149,149,149,149,149,149,149,149,127,105, 83,
 58, 53, 50, 52, 50, 58, 85,117,101, 84, 57, 71, 97,116,124,
102, 93, 66, 78, 68, 66, 52, 50, 50, 50, 58, 86,104,101, 95,
 82, 81, 69, 71, 59, 67, 66, 75, 78, 83, 87, 94,124,135,142,
129,116, 97,106,120,128,140,147,149,148,149,148,149,148,149,
147,149,129, 99, 94, 75, 68, 50, 51, 50, 50, 50, 51, 50, 52,
 52, 77,122,131,142,129,121, 98,100, 90, 64, 52, 50, 51, 50,
 54, 78, 98, 97, 96, 80, 76, 72, 70, 72, 86, 91, 92, 93, 90,
102,118,141,137,126,107, 98,110,119,136,140,138,138,147,149,
149,149,149,149,149,149,149,147,131,125, 97, 76, 52, 50, 50,
 50, 50, 50, 50, 52, 63, 81,128,141,149,141,130, 96, 87, 76,
 50, 52, 50, 52, 50, 67, 83, 89, 87, 84, 74, 82, 92, 85, 73,
 73, 82, 86,104,107,105,113,128,123,118,117,108,103,114,122,
116,118,128,141,149,149,149,149,149,149,149,149,149,145,109,
 89, 66, 50, 50, 50, 50, 50, 50, 50, 63, 77, 84,104,139,146,
149,130,102, 69, 62, 58, 50, 51, 50, 51, 50, 67, 82, 91, 87,
 91, 87, 92, 98, 95, 88, 85, 95,101,112,115,110,100,112,115,
108, 98, 99,107,112,130,135,141,149,149,149,149,149,149,149,
149,149,149,148,149,108, 79, 77, 50, 50, 50, 51, 50, 51, 50,
 66, 84, 90, 79, 99,130,123,123,108,106, 93,106, 96, 63, 50,
 50, 50, 54, 76, 79, 73, 74, 88, 99,121,134,131,121,120,118,
110,108,102, 83, 76, 86, 94,100,111,123,123,133,143,138,134,
143,148,143,149,149,149,149,149,149,149,149,149,126, 73, 52,
 50, 50, 50, 50, 50, 50, 50, 50, 67, 82, 94, 85,103,134,147,
144,125,103, 74, 77, 68, 52, 50, 50, 50, 52, 78,101,111,116,
129,131,134,133,118, 99, 89, 87, 77, 79, 81, 82, 89,114,123,
122,125,126,128,132,138,128,125,121,124,123,134,142,144,144,
146,149,149,149,149,138,105, 60, 50, 51, 50, 50, 50, 50, 50,
 59, 91,120,124,128,116,135,145,135,111, 81, 61, 50, 54, 50,
 50, 50, 56, 68, 97,129,141,139,145,143,130,111, 91, 64, 55,
 69, 83, 88, 91,105,110,131,148,144,125,114,108,102,104,103,
 96,100,114,121,128,137,140,148,149,149,149,144,138,129,116,
103, 61, 50, 51, 50, 51, 51, 55, 50, 99,131,149,143,130, 95,
 72, 92, 90, 77, 59, 74, 60, 77, 93, 94, 81, 93,111,113,121,
117, 98, 85, 98, 95, 96, 92, 91, 85, 96,109,118,119,116,109,
102,107,110,100, 81, 79, 87, 92,102,107,107,110,119,127,129,
126,127,122,118,112,103,104,112,123,133,124,112, 84, 66, 94,
 93, 88, 71, 60, 54, 91,108,109,105, 88, 87, 84,116,109,105,
 87, 88, 82, 86, 85, 66, 52, 52, 76, 97,124,124,119,101,104,
102,106,100, 91, 86, 91,103, 99, 96, 90, 91, 96,107, 99, 94,
 88, 87, 89, 91, 93, 91, 88, 93, 95, 97,107,113,117,116,120,
124,124,131,130,133,145,149,149,148,121, 64, 65, 71, 67, 60,
 59, 50, 84,129,140,141,117,107, 75, 87, 87, 75, 52, 62, 75,
 75, 96, 87, 72, 71,105,114,118,117,104, 84, 93,107,101, 95,
 88, 80, 79, 95, 90, 84, 93,107,110,110,102, 87, 77, 76, 72,
 68, 72, 75, 92,108,124,135,144,145,139,137,131,133,136,132,
135,143,146,148,149,147,131, 80, 50, 52, 72, 94, 85, 81, 83,
131,149,145,122, 59, 51, 50, 61, 69, 65, 57, 81,111,120,130,
 90, 58, 50, 69, 81, 92, 99,107,109,125,129, 93, 66, 50, 57,
 63, 85, 95,104,116,128,110, 93, 82, 77, 75, 70, 78, 77,102,
124,146,147,146,131,117,116,113,113,107,117,120,124,133,134,
129,128,125,137,148,136,122, 75, 50, 74, 94, 90, 82, 75, 76,
125,134,106, 82, 56, 51, 50, 70, 63, 59, 71,114,129,123, 98,
 53, 50, 51, 72, 82, 99,111,112,111,112, 90, 62, 63, 74, 89,
111,133,138,144,142,126,101, 86, 71, 60, 63, 84,111,126,147,
142,124,110,104, 98, 98,105,104,112,124,137,131,121,114,113,
116,126,138,145,149,149,149,131, 73, 50, 50, 53, 79, 85, 89,
103,141,149,134, 89, 50, 51, 50, 51, 50, 60, 74,101,118,107,
 92, 70, 51, 55, 84,108,124,141,142,131,120,104, 83, 84, 99,
117,128,132,125,106, 90, 77, 69, 64, 74, 90,110,116,121,116,
105,103,101, 99, 92, 91, 93,116,134,145,135,118, 97, 82, 84,
 88, 99,116,137,139,144,148,149,144,131, 98, 56, 50, 51, 77,
103,108, 94, 88, 88, 88, 62, 50, 51, 50, 55, 83,113,117,131,
126,118,106, 91, 66, 59, 75, 88,102,114,126,127,128,117, 92,
 69, 65, 63, 67, 83, 93, 93, 98,102,104,107,114,116,110, 97,
 87, 87, 89, 87, 88, 84, 84,100,114,128,134,133,126,122,119,
109, 97, 96,100,113,122,124,129,125,109,102,111,114,124,125,
101, 77, 77, 89, 97, 86, 79, 79, 88,100,103, 93, 87, 97, 98,
 95, 85, 77, 70, 86, 91, 95, 94, 94, 95, 99,103, 99,103,107,
114,111,112, 97, 79, 71, 72, 76, 90,104,109,114,121,124,116,
109,103, 99,103,113,118,115,113,109,111,105, 99, 97, 95, 99,
104,108,106,105,104,109,120,125,125,124,118,108,102, 98,100,
115,121,117,125,122,119,117,113, 99, 81, 69, 64, 62, 67, 91,
107,114,123,129,114, 97, 83, 68, 64, 70, 74, 72, 76, 79, 84,
 89, 87, 84, 91, 99, 99, 97,102,105,105,117,120,109, 99,102,
108,111,113,104, 97, 98,101,100, 95, 91, 94,100,102, 99, 88,
 80, 75, 83, 89, 94,106,118,120,117,112,100, 93, 91, 90, 89,
 90, 91, 93,105,126,126,107,112,123,127,128,115, 99,111,118,
111,106, 97, 92, 91, 92, 86, 78, 73, 79, 85, 94,105,114,108,
 96, 90, 78, 73, 72, 74, 73, 85,104,121,125,118,103, 94, 94,
 96, 98, 95,101,106,116,122,120,107, 95, 92, 87, 87, 89, 92,
 89, 88, 86, 77, 75, 78, 79, 82, 89, 92, 97,105,113,113,112,
112,111,109,107,108,106,110,115,114,101, 98,103, 99,103,110,
116,120,126,119,112,112,107, 99, 98,108,106,104,104,108,113,
109,105, 94, 83, 79, 77, 79, 87, 97,101,104,105,104, 96, 93,
 92, 90, 87, 87, 90, 91, 91, 90, 87, 82, 83, 84, 84, 86, 94,
 95, 94, 94, 97, 94, 89, 93, 90, 90, 92, 92, 91, 99,105,104,
100, 98, 92, 88, 92, 96,102,107,111,110,112,113,105, 95,100,
109,110,109,109,109,113,114,107,105, 99,102, 90, 85, 93, 96,
 86, 95,109,109,126,130,110, 92, 93, 84, 85, 92, 92, 95,103,
116,108, 93, 88, 89, 88, 91, 90, 93,108,117,109,101,102,103,
103,100, 95, 88, 93, 98, 99, 98, 95, 96, 97, 94, 91, 94, 94,
102,107,101, 90, 85, 90, 95, 99,103,106,108,113,115,111,104,
101, 95, 90, 93, 95, 96,101,106,107,112,117,115,113,114,104,
 91, 89, 98, 97, 98,106,107,108,112,110,107,108,101, 97,102,
111,111,112,113,112,114,114,114,106,101,108,116,119,122,122,
106, 97, 96, 95, 93, 94, 93, 98,109,111,106,100, 97, 96, 95,
 93, 93, 91, 90, 91, 94, 93, 89, 88, 86, 87, 90, 95, 95, 92,
 89, 92, 93, 92, 90, 86, 90, 98,103,103,102, 96, 93, 94, 98,
 93, 91, 95,103,111,112,107,102,106,104,100,100,101, 97,102,
103,104,107,111,109,104,103, 99,100,102,104, 96, 95,100,106,
108,107,108,108,108,101, 96, 94,100,109,106, 94, 93, 96, 88,
 82, 87, 94, 96, 96, 96,101,107,104, 92, 87, 89, 89, 88, 86,
 86, 88, 88, 87, 85, 86, 89, 88, 89, 92, 90, 89, 96, 99, 94,
 93, 95, 98, 99, 96, 92, 96,106,113,111,106,103,106,108,102,
 99, 96,100,107,108,107,110,110,108,104, 95, 93, 97,102, 99,
 97,100,102,100, 99, 97, 99,108,113,106, 97, 94, 98,104,108,
106,108,114,118,116,109,107,100, 94, 98, 99, 99,104,105,105,
109,110,102, 94, 93, 91, 90, 94, 98, 98, 99,101,102, 99, 97,
 96, 88, 89, 92, 93, 94, 98, 95, 92,100,102, 97, 90, 93, 97,
101, 95, 91, 92, 94, 97, 94, 94,100,102, 99, 92, 87, 91, 96,
 97, 94, 97, 98, 98, 99, 99, 96,100,109,110,109,107,106,102,
108,109,102, 99,105,107,105,106,105,111,111,111,108,112,107,
101, 96, 92, 94, 95,100,100,103,103,102,100,100,100, 99, 99,
 96, 94, 96, 96, 93, 90, 95, 98, 99, 98, 98, 93, 88, 86, 88,
 91, 90, 91, 95, 98, 94, 95, 99, 99, 98, 96, 96, 95, 95, 96,
 96, 98,101,102,100,101,101, 95, 96, 99,100,102,104,100, 99,
104,109,111,108,105,101,100,102,108,108,106,107,107,105,104,
100, 95, 97,103,104,105,107,104,101,102,103, 98, 98,100,100,
105,109,107,102,104,107,105,101, 99, 99, 97,100,100,101,105,
106,103,101,100, 98, 98, 98, 99, 99, 98,101,100,100, 99, 98,
 97, 96, 96, 95, 95, 94, 97, 96, 96, 95, 98, 95, 93, 91, 89,
 95,100,104,103,101, 97, 97, 99, 95, 90, 93, 99, 96, 96, 98,
 96, 96,100,102,103,104,103, 99, 97, 99, 97, 97, 98, 99,100,
102,104,104,101,102,103,102,104,103,102,104,104,102,101,102,
102, 99, 98,101,101,103,102,103,106,107,104, 99, 98, 96, 97,
 98, 98, 99,100,100, 99,100, 99, 97, 95, 97, 96, 96, 95, 93,
 93, 92, 92, 93, 95, 91, 92, 96, 97, 99, 96, 95, 98, 99, 98,
 93, 92, 99,101,100, 99,101,102,101,100,100,101,101,102,103,
103,104,105,103,102,100, 99, 97, 99, 98,100,103,103,105,108,
110,102, 95, 96,102,104,107,106,106,110,108,104,101,100,100,
101,101, 97, 96, 95, 99,101,103,104,104,102, 98, 98, 96, 95,
 96,101,100, 99,100,100,102,102,103,100, 98, 98, 98, 96, 96,
 99, 99,101,102,103,104,104,100, 99,100,100,101,101,102,102,
103,102,100,100,101,100, 99,102,106,106,105,105,105,104,105,
105,102,101,103,103, 99, 97, 99,100, 99,102,104,100, 99,100,
 98, 97, 98, 97, 97, 99, 99, 98,100,105,104, 99, 99,102,102,
102,100, 98, 99,102,101, 97, 96, 96, 96, 95, 95, 95, 95, 96,
 96, 96, 98,100,100, 97, 91, 86, 87, 90, 92, 93, 94, 95, 98,
 99, 96, 94, 94, 96, 96, 96, 95, 96, 95, 96, 98, 96, 95, 95,
 95, 92, 92, 93, 95, 94, 94, 96, 95, 97,100,101,101,103,103,
101,100,100,103,103,103,102,103,102,100, 98, 98,100,101,101,
100,100,101,101,100,100,100,100,102,102, 99, 99,100, 99, 98,
 98, 98, 96, 96, 98, 99, 97, 97, 98, 98, 99, 99, 98, 96, 96,
 98, 99,101,101,100,100,101,100, 98, 94, 92, 94, 95, 96, 96,
 97, 98,101,100, 99, 98,101,103,102,101,102,104,105,105,104,
104,106,106,103,101,101,100,101,103,103,100,101,101, 98, 97,
 97, 97, 99,101,101,100,102,101,100,100,100,101,100, 98, 98,
 99, 99, 99, 99, 99, 98, 99,100, 99, 99, 99,100,100, 99, 98,
 99, 98, 98, 98, 98, 99, 99, 97, 96, 96, 97, 96, 94, 95, 98,
 99, 98, 96, 95, 96, 97, 95, 93, 93, 96, 96, 96, 97, 98, 96,
 94, 95, 96, 97, 98, 97, 97, 98, 97, 96, 99,100,102,102, 99,
 98, 99,100, 99, 98, 97, 99,101,101,101,101,103,103,103,103,
102,101,101,102,102,102,101,101,104,106,104,102,102,100, 99,
100,100, 99,100,103,103,103,103,104,103,102,102,103,101,101,
101,102,103,102,103,105,108,108,104,100,102,104,102,103,104,
105,106,105,103,101,104,103,103,104,105,105,105,106,104,105,
106,103, 99, 98, 98, 99, 98, 97, 98, 99,102,102,103,104,105,
103,102,100, 99,102,103,102,104,107,108,109,108,105,104,104,
102,101,103,103,103,104,106,106,105,104,101,100,102,101,100,
101,101,100,102,101, 99, 99, 98, 97, 96, 97, 98, 97, 96, 97,
 95, 95, 96, 97, 95, 93, 93, 93, 94, 95, 97, 96, 95, 95, 95,
 94, 94, 94, 93, 96, 97, 95, 96, 98, 98, 97, 98, 97, 95, 97,
 99, 99, 99,101, 99, 98,100, 98, 96, 97, 97, 95, 97, 97, 95,
 94, 96, 97, 97, 97, 98, 98, 98, 98, 97, 96, 96, 96, 95, 95,
 96, 96, 97, 98, 98, 97, 97, 96, 95, 96, 95, 95, 95, 96, 98,
 99, 98, 97, 97, 98, 98, 97, 97, 96, 96, 97, 97, 97, 98, 99,
 99,100, 99, 99,100,102,101,100, 99, 99,101,100, 98, 98, 99,
 99, 99, 98, 97, 97, 96, 97
    };


int main(void)
{

    WDTCTL = WDTPW + WDTHOLD;                 // Stop WDT

    //Configura los puertos para reducir el consumo de energia
    P1DIR = 0xFF;       // todos los bits del puerto 1 como salidas
    P1OUT = 0;          // todas las salidas de P1 en 0

    P2DIR = 0xFF;       // todos los bits del puerto 2 como salidas
    P2OUT = 0;          // todas las salidas de P2 en 0
    P3DIR = 0xFF;       // todos los bits del puerto 3 como salidas

    P3OUT = 0x00;
    P4DIR = 0xFF;       // todos los bits del puerto 4 como salidas
    P4OUT = 0x00;

    P5DIR = 0xEF;       // todos los bits del puerto 5 como salidas
    P5OUT = 0x00;
    P6DIR = 0xFF;       // todos los bits del puerto 6 como salidas
    P6OUT = 0x00;

    P7DIR = 0xEF;       // todos los bits del puerto 5 como salidas
    P7OUT = 0x00;
    P8DIR = 0xFF;       // todos los bits del puerto 6 como salidas
    P8OUT = 0x00;

    P9DIR = 0xEF;       // todos los bits del puerto 5 como salidas
    P9OUT = 0x00;
    P10DIR = 0xFF;       // todos los bits del puerto 6 como salidas
    P10OUT = 0x00;

    P3SEL1|=BIT3;  //Asigna el bit 3 del puerto 3 al timerA1 canal 1 TA1.1

    PJSEL0 = BIT4 | BIT5;                     // For XT1

    //Desbloquea las terminales de entrada y salida
    PM5CTL0 &= ~LOCKLPM5;

    // Configuracion del sistema de reloj
    CSCTL0_H = CSKEY_H;     //Desbloquea la configuracion del reloj
    //Arranca el oscilador de 2^15Hz
    CSCTL1 = DCOFSEL_0;                       // configura el DCO a 1MHz
    CSCTL2 = SELA__LFXTCLK | SELS__DCOCLK | SELM__DCOCLK;
    CSCTL3 = DIVA__1 | DIVS__1 | DIVM__1;     // todos los divisores a 1
    CSCTL4 &= ~LFXTOFF;
    do
    {
        CSCTL5 &= ~LFXTOFFG;                    // borra la bandera  XT1 fault flag
        SFRIFG1 &= ~OFIFG;
    }while (SFRIFG1&OFIFG);                   // Test oscillator fault flag

    CSCTL1 = DCOFSEL_6;                     // configura el DCO a 8MHz
    // configura SMCLK = MCLK = DCO, ACLK = LFXT
    CSCTL2 = SELA__LFXTCLK | SELS__DCOCLK | SELM__DCOCLK;

    CSCTL3 = DIVA__1 | DIVS__1 | DIVM__1;   // configura todos los divisores entre 1 para operar a 8MHz

    CSCTL0_H = 0;                           // Bloquea los registros del modulo de reloj

    //Configura los estados de espera de la FRAM
    //0 para 8MHZ o menos
    FRCTL0 = FWPW | NWAITS_0;


    /***************Todo**************/
        // Revisar el codigo del timer

  indice=0;
  //Periodo de la senial PWM
  TA1CCR0=200-1;
  //Ciclo de servicio inicial
  TA1CCR1=senial[indice];
  //Activa la interrupcion del canal 0
  TA1CCTL0|=CCIE;
  //Canal 1 del Timer 1 como comparacion, Modo de salida reset-set
  TA1CCTL1=OUTMOD_7+CCIE; //int. habilitada
  //Reloj del TA1=SMCLK, modo up,borra el contador
  TA1CTL=TASSEL1+MC_1+TACLR;

  while(1)
  {
    //No se puede entrar a modo LPM3 por que se ocupa el SMCLK
    __bis_SR_register(LPM0_bits + GIE);     // Entra a modo LPM0 con
                      //interrupciones habilitadas
  }
}

/*Rutina de atencion de interrupciones del CCR0 del temporizador A1*/
#if defined(__TI_COMPILER_VERSION__) || defined(__IAR_SYSTEMS_ICC__)
#pragma vector=TIMER1_A0_VECTOR
__interrupt void captura0 (void)
#elif defined(__GNUC__)
void __attribute__ ((interrupt(TIMER1_A0_VECTOR))) captura0 (void)
#else
#error Compiler not supported!
#endif
{
    ciclos++;
    if(ciclos>=5){
        ciclos=0;
        indice++;
        if(indice>=3622) indice=0;
    }
}


/*Rutina de atencion de interrupciones del CCR1 del temporizador A1*/
// Timer0_A1 Interrupt Vector (TAIV) handler
#if defined(__TI_COMPILER_VERSION__) || defined(__IAR_SYSTEMS_ICC__)
#pragma vector=TIMER1_A1_VECTOR
__interrupt void TIMER1_A1_ISR(void)
#elif defined(__GNUC__)
void __attribute__ ((interrupt(TIMER1_A1_VECTOR))) TIMER1_A1_ISR (void)
#else
#error Compiler not supported!
#endif
{
  switch(__even_in_range(TA1IV, TA1IV_TAIFG))
  {
    case TA1IV_NONE:   break;               // No interrupt
    case TA1IV_TACCR1:                // CCR1
        TA1CCR1=senial[indice];
        break;
    case TA1IV_TACCR2: break;               // CCR2
    case TA1IV_3:      break;               // reserved
    case TA1IV_4:      break;               // reserved
    case TA1IV_5:      break;               // reserved
    case TA1IV_6:      break;               // reserved
    case TA1IV_TAIFG:  break;               // overflow

    default: break;
  }
}

